<div class="git-wiki-page">
  <section>

    {% include git-wiki/sections/tools/tools.html %}

    {% include git-wiki/components/toc/toc.html %}

    {% if site.inc_before_content %}
    {% include {{ site.inc_before_content }} %}
    {% endif %}

    {% for p in site.pages %}
        [{{ p.name }}]: ({{ p.url }}) "{{ p.title }}"
        <br>
    {% endfor %}
    
    {% assign contentarray = page.content | split:'[//begin]: # "Autogenerated link references for markdown compatibility"' %}
    {% assign autolinks = contentarray[1] | lstrip | remove:'[//end]: # "Autogenerated link references"' | rstrip | split:'[' %}
    {{ contentarray[1] }}
    <br>
    {{ autolinks | inspect }}
    <br>
    {% for item in autolinks %}
        {{ item }}
        <br>
        {% assign markdown_link = item | split:']:' %}
        {% assign link_name = markdown_link[0] %}
        {% assign url_and_title = markdown_link[1] | split:' "' %}
        {% assign url = url_and_title[0] | remove:'.md' %}
        {% assign title = url_and_title[1] | remove:'"' | strip_newlines %}
        {% assign result = site.pages | where: 'title',title %}

        {% if forloop.index == 2 %}
            {% assign md_links = link_name %}
            {% assign urls = result[0].url %}
            {% assign titles = title %}
        {% else %}
            {% assign md_links = md_links | append: ',' | append: link_name %}
            {% assign urls = urls | append: ',' | append: result[0].url %}
            {% assign titles = titles | append: ',' | append: title %}
        {% endif %}
    {% endfor %}

    {%  assign md_links_array = md_links |  split:',' %}
    {%  assign urls_array = urls |  split:',' %}
    {%  assign titles_array = titles |  split:',' %}

    {% assign contentarray_1 =  '[//begin]: # "Autogenerated link references for markdown compatibility"\n\n' %}
    {% for new_url in urls_array %}
        {% assign rebuilt_autolink = '[' | append:md_links_array[forloop.index0] | append:']: ' | append:new_url | append:' "' | append:titles_array[forloop.index0] | append:'"\n\n' %}
        {% assign contentarray_1 = contentarray_1 |  append:rebuilt_autolink %}
        {{ rebuilt_autolink }} <br>
        {{ contentarray_1 }} <br>
    {% endfor %}
    {% assign contentarray_1 = contentarray_1 | append:'[//end]: # "Autogenerated link references"' %}
    {% assign contentarray[1] = contentarray_1 %}
    {{ contentarray[1] }}
    <br>
    {% assign content = contentarray | join:'' | markdownify %}
    
    <div id="git-wiki-content">
      {{ content }}
    </div>

    {% comment %} {% assign contentarray = content | split:'[[' %}
    {% for item in contentarray %}
        {% if forloop.index > 1 %}
            {% assign itemparts = item | split:']]' %}
            {% if forloop.index == 2 %}
                {% assign links = itemparts[0] %}
            {% else %}
                {% assign links = links | append: ',' | append: itemparts[0] %}
            {% endif %}
            {% assign result = site.pages | where: 'title',itemparts[0] %}
            {{ itemparts[0] }}
            {% if result and result.size != 0 %}
                <p>{{ result }}</p>
                <p>{{ result[0].url }}</p>
                <br>
            {% else %}
                <p>No Match Found</p>
                <br>
            {% endif %}
            
            {% if result and result.size != 0 %}
                {% if forloop.index == 2 %}
                    {% assign urls = '_' %}
                {% else %}
                    {% assign urls = urls | append: ',' | append: '_' %}
                {% endif %}
            {% else %}
                {% if forloop.index == 2 %}
                    {% assign urls = result[0].url %}
                {% else %}
                    {% assign urls = urls | append: ',' | append: result[0].url %}
                {% endif %}
            {% endif %}
        {% endif %}
    {% endfor %}

    {% assign urlarray = urls | split:',' %}
    {% assign linkarray = links | split:',' %}

    {% assign replacedcontent = content %}
    {% for item in linkarray %}
        {% if urlarray[forloop.index0] != "_" %}
            {% assign linktext = '<a href="' | append: urlarray[forloop.index0] | append: '">' | append: item | append: '</a>' %}
            {% assign bracketlink = '[[' | append: item | append: ']]' %}
            {% assign replacedcontent = replacedcontent | replace: bracketlink,linktext %}
        {% endif %}
    {% endfor %}

    {{ replacedcontent | markdownify }} {% endcomment %}

    {% if site.inc_after_content %}
    {% include {{ site.inc_after_content }} %}
    {% endif %}
  </section>
</div>